### 系统是怎么加载的？
1. 生成系统镜像。源代码编译完成后，得到两个可执行文件，一个是bootblock，主要负责初始化环境，加载内核文件到内存中；另一个就是内核可执行文件。用dd命令制作一个硬盘，并且将bootblock写入到硬盘的第0号扇区(主引导扇区)，将内核文件写入到硬盘的第1号扇区开始的地方。就得到了一个镜像文件。
2. 机器上电后，是出于实模式状态下的。首先执行的是BIOS的代码，这是固化在主板上的。BIOS负责初始化各个基础硬件设备，提供基本的IO服务，检查机器状态。之后BIOS会检查主引导扇区，加载主引导扇区中的bootblock到内存的0x7C00处。随着一条跳转指令，是CS=0x0000, IP=0x7C00。就把CPU的执行权交给了bootblock模块。
3. bootblock的主要工作就是初始化各个寄存器，打开A20地址线，探测可用的物理内存，设置初始的全局描述符切换到保护模式。把0x7C00作为栈底，调用C函数读取内核文件到物理内存1M开始处。之后调用内核入口函数。
4. 内核入口函数重新设置了全局描述符表，设置了新的栈之后，跳到内核初始化总控函数。在此函数中又执行了内存初始化、中断初始化、虚拟内存初始化等子模块的初始化工作。当所有工作完成后，内核执行流演变成idle内核线程。此时整个系统就可以运转起来了。

### 什么是bootblock？功能是什么
1. bootblock是引导程序，写入到硬盘的主引导扇区，所以其大小不能超过512个字节，并且最后两个字节一定是内核魔数0x55AA，不然BIOS就无法识别。
2. bootblock的功能是从BIOS中接过CPU的执行权，然后开始初始化内核运行所必须的环境，包括打开A20地址线、准备全局描述符表并切换到保护模式，设置C函数运行所必须的栈空间，加载内核文件到内存中，再把CPU执行权交给内核。

### 实模式是什么？保护模式又是什么?
1. 实模式是CPU的初始的工作模式。在此模式下，CPU的寻址命令都被当成物理地址直接送上总线去访存。其寻址方式是段寄存器左移4位加上段内偏移，目的是为了访问0~1MB的内存空间。在此模式下，任何应用程序都可以访问任意地址，是非常不安全的。
2. 保护模式主要加强了对内存访问权限的保护。在此模式下程序不能随意地访问地址空间，会有权限检查。寄存器位数也从16位扩展到了32位。保护模式的保护功能的关键是全局描述符表，该表的每一项都是一个全局描述符，描述了段的起始地址和段界限，此外还包含访问权限的信息。段寄存器的值将作为全局描述符表的索引，得到段基址后加上段内偏移就是要访问的内存地址。

### 为什么要打开A20地址线?
这是历史原因造成的。在实模式下，段寄存器左移4位+段内偏移的访存方式实际上是有可能超出1M的范围。所以，工程师让A10的地址线永远位0，当地址访问超过1MB时，会自动回圈，相当于时取模了。而保护模式下的可用寄存器位数虽然是32位，但由于A20地址先总是0，只能访问偶数M的空间。所以必须打开A20地址线。

### 怎么切换保护模式？
1. 准备好全局描述符表。
2. 将表起始地址和长度记录在一个6B结构体中，使用lgdt加载该结构体。
3. 设置段寄存器，其值作为索引访问全局描述符表。
4. 将CR0寄存器最低位置1。
5. 长跳转到32位指令处开始执行。

### 怎么探测物理内存
1. 向BIOS询问，使用其INT15h中断服务程序。
2. 将探测到的e820结构体信息保存在内存中的一块区域。内存信息主要是内存起始地址，长度，是否可用。

### 怎么制作空白硬盘
使用linux的dd命令
dd if=/dev/zero of=ucore.img count = 10000
if : 用于指明要写入的文件
of : 用于指明要写出到哪的文件
count: 拷贝的块数量 块大小由bs指明，默认是512字节
conv: 是否截断输出文件
seek：从哪个块开始写入 

### 怎么读入内核？
1. 首先读取第1个扇区的内核ELF头文件到内存中。
2. 根据头文件中的信息，找到程序头表的起始地址，然后根据ELF中的程序头表中的信息，依次读出各个section以及其虚拟内存地址。将其放到指定地址中。
3. 调用ELF头中指定的入口函数。